# Вариант 13 — Микро-шоп «Добавь в корзину» — Карточки (пользовательские истории с критериями приёмки)

## 1. Регистрация и вход

**Как** новый пользователь **я хочу** зарегистрироваться и войти в систему, **чтобы** получить доступ к каталогу и возможности делать заказы.

**Критерии приёмки:**
- AC1.1: Пользователь может зарегистрироваться, указав email и пароль (минимум 8 символов)
- AC1.2: При регистрации с существующим email возвращается ошибка "Email already exists"
- AC1.3: После успешной регистрации пользователь автоматически входит в систему
- AC1.4: Пользователь может войти, указав email и пароль
- AC1.5: При неверных credentials возвращается ошибка "Invalid email or password"
- AC1.6: После входа пользователь получает JWT токен и может делать авторизованные запросы

**Валидация:**
- email: обязательное, формат email, уникальность
- password: обязательное, минимум 8 символов
- Ошибки: "Email is required", "Invalid email format", "Password must be at least 8 characters"

---

## 2. Просмотр каталога товаров

**Как** пользователь **я хочу** просматривать каталог товаров с фильтрами и поиском, **чтобы** быстро найти нужный товар.

**Критерии приёмки:**
- AC2.1: Пользователь видит список товаров с изображением, названием, ценой и наличием
- AC2.2: Пользователь может фильтровать товары по категории
- AC2.3: Пользователь может фильтровать товары по диапазону цен (minPrice, maxPrice)
- AC2.4: Пользователь может искать товары по названию/описанию (поисковый запрос)
- AC2.5: Список товаров поддерживает пагинацию (по умолчанию 20 товаров на странице)
- AC2.6: При клике на товар открывается страница с деталями

**Валидация:**
- minPrice, maxPrice: числа >= 0, maxPrice >= minPrice
- search: строка, необязательная
- category: строка, необязательная
- Ошибки: "Invalid price range", "Search query is too short"

---

## 3. Добавление товара в корзину

**Как** пользователь **я хочу** добавлять товары в корзину, **чтобы** собрать заказ перед оформлением.

**Критерии приёмки:**
- AC3.1: Пользователь может добавить товар в корзину с указанием количества
- AC3.2: Если товар уже в корзине, количество обновляется (не создаётся дубликат)
- AC3.3: Количество не может превышать stock товара
- AC3.4: При попытке добавить товар с количеством > stock возвращается ошибка "Insufficient stock"
- AC3.5: После добавления товара корзина обновляется и отображается актуальная сумма

**Валидация:**
- productId: обязательное, UUID, товар должен существовать
- quantity: обязательное, integer > 0, <= stock товара
- Ошибки: "Product not found", "Quantity must be greater than 0", "Insufficient stock"

---

## 4. Управление корзиной

**Как** пользователь **я хочу** изменять количество товаров в корзине и удалять товары, **чтобы** скорректировать заказ.

**Критерии приёмки:**
- AC4.1: Пользователь может изменить количество товара в корзине
- AC4.2: При изменении количества проверяется наличие на складе
- AC4.3: Пользователь может удалить товар из корзины
- AC4.4: Пользователь может очистить всю корзину
- AC4.5: Корзина автоматически пересчитывает общую сумму при изменениях

**Валидация:**
- quantity: integer > 0, <= stock
- Ошибки: "Quantity must be greater than 0", "Insufficient stock"

---

## 5. Применение купона

**Как** пользователь **я хочу** применить купон при оформлении заказа, **чтобы** получить скидку.

**Критерии приёмки:**
- AC5.1: Пользователь может ввести код купона при оформлении заказа
- AC5.2: Система проверяет валидность купона (существует, активен, в пределах срока действия)
- AC5.3: При валидном купоне скидка рассчитывается и применяется к сумме заказа
- AC5.4: При невалидном купоне возвращается ошибка с описанием причины
- AC5.5: Скидка отображается отдельной строкой в итоговой сумме

**Валидация:**
- couponCode: строка, необязательная
- Ошибки: "Coupon not found", "Coupon is expired", "Coupon is not active"

---

## 6. Оформление заказа

**Как** пользователь **я хочу** оформить заказ из корзины, **чтобы** получить товары.

**Критерии приёмки:**
- AC6.1: Пользователь может выбрать адрес доставки из своих адресов или добавить новый
- AC6.2: Пользователь может применить купон (опционально)
- AC6.3: При оформлении заказа проверяется наличие всех товаров на складе
- AC6.4: Заказ создаётся со статусом PENDING, корзина очищается
- AC6.5: Создаётся платёж (заглушка) со статусом COMPLETED
- AC6.6: Количество товаров на складе уменьшается на количество в заказе

**Валидация:**
- addressId: обязательное, UUID, адрес должен принадлежать пользователю
- couponCode: необязательное, строка
- Ошибки: "Cart is empty", "Address not found", "Insufficient stock for product X", "Invalid coupon"

---

## 7. Просмотр истории заказов

**Как** пользователь **я хочу** просматривать историю своих заказов, **чтобы** отслеживать статусы и детали.

**Критерии приёмки:**
- AC7.1: Пользователь видит список своих заказов с датой, статусом и суммой
- AC7.2: Список поддерживает пагинацию
- AC7.3: Пользователь может открыть детали заказа (товары, адрес, купон, платёж)
- AC7.4: Администратор видит все заказы всех пользователей

**Валидация:**
- page: integer >= 0, default 0
- size: integer > 0, default 20
- status: необязательное, enum [PENDING, PAID, PROCESSING, SHIPPED, DELIVERED, CANCELLED]

---

## 8. Управление товарами (Администратор)

**Как** администратор **я хочу** управлять товарами (создавать, редактировать, удалять), **чтобы** поддерживать актуальный каталог.

**Критерии приёмки:**
- AC8.1: Администратор может создать новый товар с указанием всех полей
- AC8.2: Администратор может редактировать существующий товар (частичное обновление)
- AC8.3: Администратор может удалить товар (soft delete или hard delete)
- AC8.4: При создании/редактировании товара валидируются все поля
- AC8.5: Товар появляется в каталоге сразу после создания

**Валидация:**
- name: обязательное, строка, не пустая
- price: обязательное, decimal > 0
- stock: обязательное, integer >= 0
- category: необязательное, строка
- description: необязательное, текст
- imageUrl: необязательное, URL
- Ошибки: "Name is required", "Price must be greater than 0", "Stock cannot be negative"

---

## 9. Управление заказами (Администратор)

**Как** администратор **я хочу** просматривать все заказы и изменять их статусы, **чтобы** управлять процессом доставки.

**Критерии приёмки:**
- AC9.1: Администратор видит список всех заказов с фильтрацией по статусу
- AC9.2: Администратор может изменить статус заказа (PENDING → PAID → PROCESSING → SHIPPED → DELIVERED)
- AC9.3: Администратор может отменить заказ (статус CANCELLED)
- AC9.4: При отмене заказа товары возвращаются на склад

**Валидация:**
- status: обязательное, enum [PENDING, PAID, PROCESSING, SHIPPED, DELIVERED, CANCELLED]
- Ошибки: "Invalid status transition", "Order not found"

---

## 10. Управление купонами (Администратор)

**Как** администратор **я хочу** создавать и управлять купонами, **чтобы** предоставлять скидки пользователям.

**Критерии приёмки:**
- AC10.1: Администратор может создать купон с указанием кода, процента скидки и срока действия
- AC10.2: Администратор может редактировать купон (процент скидки, срок действия, активность)
- AC10.3: Администратор может деактивировать купон (is_active = false)
- AC10.4: Код купона должен быть уникальным
- AC10.5: Процент скидки должен быть в диапазоне 0-100

**Валидация:**
- code: обязательное, строка, уникальное, не пустое
- discountPercent: обязательное, integer, 0-100
- validFrom: обязательное, timestamp
- validTo: обязательное, timestamp, > validFrom
- isActive: boolean, default true
- Ошибки: "Code already exists", "Discount percent must be between 0 and 100", "Valid to must be after valid from"

---

## 11. Управление адресами доставки

**Как** пользователь **я хочу** управлять своими адресами доставки, **чтобы** быстро выбирать адрес при оформлении заказа.

**Критерии приёмки:**
- AC11.1: Пользователь может добавить новый адрес доставки
- AC11.2: Пользователь может редактировать существующий адрес
- AC11.3: Пользователь может удалить адрес
- AC11.4: Пользователь может установить адрес как адрес по умолчанию
- AC11.5: При оформлении заказа можно выбрать адрес из списка или добавить новый

**Валидация:**
- street: обязательное, строка, не пустая
- city: обязательное, строка, не пустая
- postalCode: обязательное, строка, не пустая
- country: обязательное, строка, не пустая
- isDefault: boolean, default false
- Ошибки: "Street is required", "City is required", "Postal code is required", "Country is required"
